version: "2"
type: frontend
tech_stack:
  - TypeScript 5
  - Next.js 16 (App Router)
  - React 19
  - Tailwind CSS v4
  - shadcn/ui (Radix UI)
  - lucide-react
  - Supabase (Auth + PostgreSQL + Storage + RLS)
  - React Query
  - Zustand
  - Dexie.js (IndexedDB)
  - react-hook-form
  - Zod
  - Framer Motion
  - jsPDF
  - PWA (@ducanh2912/next-pwa)
routes:
  - path: /
    file: src/app/page.tsx
    auth_required: false
    description: Landing page with hero, features, and CTA
  - path: /login
    file: src/app/(auth)/login/page.tsx
    auth_required: false
    description: Login form with email and password
  - path: /register
    file: src/app/(auth)/register/page.tsx
    auth_required: false
    description: Registration form (name, email, password, confirm)
  - path: /forgot-password
    file: src/app/(auth)/forgot-password/page.tsx
    auth_required: false
    description: Password recovery request form
  - path: /reset-password
    file: src/app/(auth)/reset-password/page.tsx
    auth_required: false
    description: Set new password via email link
  - path: /invite/{code}
    file: src/app/invite/[code]/page.tsx
    auth_required: false
    description: Accept trip invitation link
  - path: /offline
    file: src/app/offline/page.tsx
    auth_required: false
    description: Offline fallback page for PWA
  - path: /unsubscribe
    file: src/app/(auth)/unsubscribe/page.tsx
    auth_required: false
    description: Email unsubscribe page
  - path: /trips
    file: src/app/(app)/trips/page.tsx
    auth_required: true
    description: List all user trips with create trip button
  - path: /settings
    file: src/app/(app)/settings/page.tsx
    auth_required: true
    description: User profile, password change, email preferences, danger zone
  - path: /trip/{id}
    file: src/app/(app)/trip/[id]/page.tsx
    auth_required: true
    description: Trip dashboard with stats, activity log, polls
  - path: /trip/{id}/itinerary
    file: src/app/(app)/trip/[id]/itinerary/page.tsx
    auth_required: true
    description: Daily itinerary with activities timeline
  - path: /trip/{id}/expenses
    file: src/app/(app)/trip/[id]/expenses/page.tsx
    auth_required: true
    description: Expense list with add, edit, delete
  - path: /trip/{id}/balance
    file: src/app/(app)/trip/[id]/balance/page.tsx
    auth_required: true
    description: Participant balances and settlement suggestions
  - path: /trip/{id}/budget
    file: src/app/(app)/trip/[id]/budget/page.tsx
    auth_required: true
    description: Budget tracking by category with progress bars
  - path: /trip/{id}/participants
    file: src/app/(app)/trip/[id]/participants/page.tsx
    auth_required: true
    description: Member list, invite by email or link
  - path: /trip/{id}/checklists
    file: src/app/(app)/trip/[id]/checklists/page.tsx
    auth_required: true
    description: Packing lists and checklists with items
  - path: /trip/{id}/notes
    file: src/app/(app)/trip/[id]/notes/page.tsx
    auth_required: true
    description: Shared trip notes
features:
  - name: User Login
    description: Login with email and password credentials via Supabase Auth
    files:
      - src/app/(auth)/login/page.tsx
      - src/lib/supabase/auth.ts
    entry_route: /login
    user_interactions:
      - Fill email input field
      - Fill password input field
      - Click "Entrar" button to submit
      - See error message on invalid credentials
      - Redirect to /trips on success
    api_calls:
      - method: POST
        endpoint: supabase.auth.signInWithPassword
    auth_required: false
  - name: User Registration
    description: Register new account with name, email, password
    files:
      - src/app/(auth)/register/page.tsx
      - src/lib/supabase/auth.ts
    entry_route: /register
    user_interactions:
      - Fill name input field
      - Fill email input field
      - Fill password input field
      - Fill confirm password input field
      - Click "Criar conta" button to submit
      - See success message to check email
    api_calls:
      - method: POST
        endpoint: supabase.auth.admin.createUser
    auth_required: false
  - name: Password Recovery
    description: Request password reset email
    files:
      - src/app/(auth)/forgot-password/page.tsx
      - src/app/(auth)/reset-password/page.tsx
      - src/lib/supabase/auth.ts
    entry_route: /forgot-password
    user_interactions:
      - Fill email input field
      - Click submit button
      - Check email for reset link
      - Fill new password on reset page
      - Click submit to save new password
    api_calls:
      - method: POST
        endpoint: supabase.auth.resetPasswordForEmail
    auth_required: false
  - name: Trip Management
    description: Create, edit, and delete trips with 3-step wizard
    files:
      - src/app/(app)/trips/page.tsx
      - src/components/trips/create-trip-dialog.tsx
      - src/components/trips/edit-trip-dialog.tsx
      - src/components/trips/delete-trip-dialog.tsx
      - src/lib/supabase/trips.ts
    entry_route: /trips
    user_interactions:
      - Click "Nova viagem" button to open create dialog
      - Fill trip name, destination, description (step 1)
      - Select start and end dates, trip style (step 2)
      - Choose base currency and transport type (step 3)
      - Click submit to create trip
      - Click trip card to open trip dashboard
      - Click edit menu to modify trip details
      - Click delete menu to remove trip
    api_calls:
      - method: POST
        endpoint: supabase.rpc.create_trip_with_member
      - method: PATCH
        endpoint: supabase.from.trips.update
      - method: POST
        endpoint: supabase.rpc.delete_trip_cascade
    auth_required: true
  - name: Itinerary Activities
    description: Plan daily activities with time, location, and category
    files:
      - src/app/(app)/trip/[id]/itinerary/page.tsx
      - src/components/activities/add-activity-dialog.tsx
      - src/components/activities/edit-activity-dialog.tsx
      - src/components/activities/activity-form-fields.tsx
      - src/lib/supabase/activities.ts
    entry_route: /trip/{id}/itinerary
    user_interactions:
      - Click "Adicionar atividade" to add activity
      - Fill title, date, start time, duration
      - Select location with autocomplete
      - Choose category
      - Click submit to save
      - Click activity to edit
      - Click delete to remove activity
      - Drag to reorder activities
    api_calls:
      - method: POST
        endpoint: supabase.from.activities.insert
      - method: PATCH
        endpoint: supabase.from.activities.update
      - method: DELETE
        endpoint: supabase.from.activities.delete
    auth_required: true
  - name: Expense Tracking
    description: Record expenses with splits among trip members
    files:
      - src/app/(app)/trip/[id]/expenses/page.tsx
      - src/components/expenses/add-expense-dialog.tsx
      - src/components/expenses/expense-card.tsx
      - src/components/forms/currency-amount-input.tsx
      - src/components/forms/member-split-selector.tsx
      - src/lib/supabase/expenses.ts
    entry_route: /trip/{id}/expenses
    user_interactions:
      - Click "Adicionar despesa" to add expense
      - Fill description, amount, currency, date, category
      - Select who paid
      - Choose split type (equal, by amount, by percentage)
      - Select participants and adjust splits
      - Click submit to save expense
      - Click expense card to edit
      - Click delete to remove expense
    api_calls:
      - method: POST
        endpoint: supabase.from.expenses.insert
      - method: PATCH
        endpoint: supabase.from.expenses.update
      - method: POST
        endpoint: supabase.rpc.delete_expense_cascade
    auth_required: true
  - name: Balance and Settlements
    description: View balances, settlement suggestions, and PIX QR codes
    files:
      - src/app/(app)/trip/[id]/balance/page.tsx
      - src/components/balance/balance-summary.tsx
      - src/components/settlements/settlement-history.tsx
      - src/components/settlements/mark-settled-dialog.tsx
      - src/components/settlements/pix-qr-dialog.tsx
      - src/lib/supabase/expense-summary.ts
      - src/lib/supabase/settlements.ts
    entry_route: /trip/{id}/balance
    user_interactions:
      - View participant balances (positive/negative)
      - View suggested settlements
      - Click to mark settlement as paid
      - Generate PIX QR code for payment
      - View settlement history
    api_calls:
      - method: GET
        endpoint: supabase.rpc.getTripExpenseSummary
      - method: POST
        endpoint: supabase.from.settlements.insert
    auth_required: true
  - name: Budget Tracking
    description: Set category budgets and track spending progress
    files:
      - src/app/(app)/trip/[id]/budget/page.tsx
      - src/components/budget/budget-form-dialog.tsx
      - src/components/budget/budget-card.tsx
      - src/lib/supabase/budgets.ts
    entry_route: /trip/{id}/budget
    user_interactions:
      - Click "Adicionar orcamento" to add budget
      - Select category and set amount
      - Click submit to save
      - View progress bars (spent vs budgeted)
      - Click to edit budget amount
      - Click to delete budget
    api_calls:
      - method: POST
        endpoint: supabase.from.budgets.insert
      - method: PATCH
        endpoint: supabase.from.budgets.update
      - method: DELETE
        endpoint: supabase.from.budgets.delete
    auth_required: true
  - name: Checklists
    description: Create packing lists and checklists with items
    files:
      - src/app/(app)/trip/[id]/checklists/page.tsx
      - src/components/checklists/checklist-form-dialog.tsx
      - src/components/checklists/checklist-card.tsx
      - src/lib/supabase/checklists.ts
    entry_route: /trip/{id}/checklists
    user_interactions:
      - Click "Nova checklist" to create
      - Enter checklist name
      - Add items to checklist
      - Click checkbox to toggle items
      - Delete items or entire checklist
    api_calls:
      - method: POST
        endpoint: supabase.from.checklists.insert
      - method: PATCH
        endpoint: supabase.from.checklists.update
      - method: DELETE
        endpoint: supabase.from.checklists.delete
    auth_required: true
  - name: Trip Notes
    description: Shared notes for trip planning
    files:
      - src/app/(app)/trip/[id]/notes/page.tsx
      - src/components/notes/add-note-dialog.tsx
      - src/components/notes/edit-note-dialog.tsx
      - src/components/notes/note-card.tsx
      - src/lib/supabase/notes.ts
    entry_route: /trip/{id}/notes
    user_interactions:
      - Click "Nova nota" to add note
      - Enter title and content
      - Click submit to save
      - Click note to edit
      - Click pin to pin note to top
      - Click delete to remove note
    api_calls:
      - method: POST
        endpoint: supabase.from.notes.insert
      - method: PATCH
        endpoint: supabase.from.notes.update
      - method: DELETE
        endpoint: supabase.from.notes.delete
    auth_required: true
  - name: Participants and Invites
    description: Invite members via email or link, manage participants
    files:
      - src/app/(app)/trip/[id]/participants/page.tsx
      - src/app/invite/[code]/page.tsx
      - src/components/invites/invite-dialog.tsx
      - src/components/invites/invite-by-email-form.tsx
      - src/lib/supabase/invites.ts
    entry_route: /trip/{id}/participants
    user_interactions:
      - View member list
      - Click to invite by email
      - Click to create shareable invite link
      - Copy invite link
      - Remove member (organizer only)
      - Leave trip
    api_calls:
      - method: POST
        endpoint: supabase.from.invites.insert
      - method: POST
        endpoint: supabase.rpc.acceptInvite
      - method: DELETE
        endpoint: supabase.from.trip_members.delete
    auth_required: true
  - name: Trip Dashboard
    description: Central hub with stats, activity feed, polls
    files:
      - src/app/(app)/trip/[id]/page.tsx
      - src/app/(app)/trip/[id]/trip-content.tsx
      - src/components/polls/create-poll-dialog.tsx
      - src/components/polls/poll-card.tsx
      - src/lib/supabase/dashboard.ts
      - src/lib/supabase/activity-log.ts
      - src/lib/supabase/polls.ts
    entry_route: /trip/{id}
    user_interactions:
      - View trip stats (total spent, budget, members, activities)
      - View activity log feed
      - Create poll with question and options
      - Vote on existing polls
      - Quick navigate to itinerary, expenses, balance
    api_calls:
      - method: GET
        endpoint: supabase.rpc.getDashboardData
      - method: GET
        endpoint: supabase.rpc.getTripActivityLog
      - method: POST
        endpoint: supabase.from.polls.insert
      - method: POST
        endpoint: supabase.from.poll_votes.insert
    auth_required: true
  - name: Settings and Profile
    description: User profile, password change, email preferences, danger zone
    files:
      - src/app/(app)/settings/page.tsx
      - src/components/profile/profile-form.tsx
      - src/components/settings/password-change-form.tsx
      - src/components/settings/email-preferences-form.tsx
      - src/components/settings/danger-zone.tsx
      - src/lib/supabase/profile.ts
      - src/lib/supabase/account.ts
    entry_route: /settings
    user_interactions:
      - Upload avatar photo
      - Edit name and email
      - Change password (old + new + confirm)
      - Toggle email notification preferences
      - Delete account (confirm with email input)
    api_calls:
      - method: PATCH
        endpoint: supabase.from.users.update
      - method: POST
        endpoint: supabase.auth.updateUser
      - method: POST
        endpoint: supabase.rpc.deleteAccount
    auth_required: true
  - name: Export Reports
    description: Export trip data as PDF or CSV
    files:
      - src/components/export/export-button.tsx
      - src/lib/utils/export-pdf.ts
      - src/lib/supabase/trip-export-data.ts
    entry_route: /trip/{id}
    user_interactions:
      - Click "Exportar PDF" button
      - Download generated PDF with trip summary
      - Click "Exportar CSV" button
      - Download CSV with expense data
    api_calls:
      - method: GET
        endpoint: supabase.rpc.getTripExportData
    auth_required: true
known_limitations:
  - issue: AI Receipt Analysis is simulated - photo capture works but extraction is not implemented
    location: src/components/expenses/add-expense-dialog.tsx
    impact: Users cannot auto-extract amount/description from receipts
  - issue: Flight search dialog exists but flight API is not connected
    location: src/components/trips/create-trip-dialog.tsx
    impact: Flight search returns no results
  - issue: Real-time presence infrastructure exists but is not fully implemented
    location: src/lib/supabase/realtime.ts
    impact: Users cannot see who else is viewing the same page
  - issue: Push notifications PWA support exists but backend does not send them
    location: public/sw.js
    impact: No push notification delivery
  - issue: App uses Portuguese (pt-BR) throughout - all buttons, labels, and messages are in Portuguese
    location: All UI components
    impact: Tests must use Portuguese text for assertions and interactions
